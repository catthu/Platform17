// This is the command dispatcher
// Implements the different command layers in order